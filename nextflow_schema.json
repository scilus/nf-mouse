{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://raw.githubusercontent.com/scilus/nf-mouse/nextflow_schema.json",
    "title": "scilus/nf-mouse pipeline parameters",
    "description": "nf-mouse is a neuroimaging pipeline to process ex-vivo dMRI data.",
    "type": "object",
    "$defs": {
        "input_output_options": {
            "title": "Input/output options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": [
                "input"
            ],
            "properties": {
                "input": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "schema": "assets/schema_input.json",
                    "mimetype": "text/csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to the input directory location.",
                    "help_text": "Ensure the data structure is respected. For more information, see the [documentation](https://scilus.github.io/nf-mouse/guides/inputs/)",
                    "fa_icon": "fas fa-file-csv"
                },
                "outdir": {
                    "type": "string",
                    "description": "The output directory where the results will be saved. You have to use absolute paths to storage on Cloud infrastructure.",
                    "help_text": "For a detailed description of the output files, please see the [documentation](https://scilus.github.io/nf-mouse/guides/outputs/).",
                    "fa_icon": "fas fa-folder-open",
                    "default": "results_mouse"
                }
            }
        },
        "general_options": {
            "title": "General options",
            "type": "object",
            "fa_icon": "fas fa-cogs",
            "description": "Major options.",
            "properties": {
                "use_preqc": {
                    "type": "boolean",
                    "default": false, 
                    "description": "Set it to true, if you want to use the output of the preqc. Needs to be combined with profile run_qc",
                    "fa_icon": "fas fa-brain"
                },
                "use_fodf": {
                    "type": "boolean",
                    "default": false,
                    "description": "Set it to true if you want to fODF instead of QBall reconstruction.",
                    "fa_icon": "fas fa-brain"
                },
                "processes": {
                    "type": "integer",
                    "default": 10,
                    "hidden": true,
                    "fa_icon": "fas fa-brain"
                }
            }
        },
        "skip_steps_options": {
            "title": "Skip steps options",
            "type": "object",
            "fa_icon": "fas fa-forward",
            "description": "Options to skip specific steps of the pipeline.",
            "properties": {
                "run_denoising": {
                    "type": "boolean",
                    "default": true,
                    "description": "Set it to false if you don't want to denoise your data.",
                    "fa_icon": "fas fa-brain"
                },
                "run_eddy": {
                    "type": "boolean",
                    "default": true,
                    "description": "Set it to false if you don't want to use eddy correction.",
                    "fa_icon": "fas fa-brain"
                },
                "run_n4": {
                    "type": "boolean",
                    "default": true,
                    "description": "Set it to false if you don't want to use N4.",
                    "fa_icon": "fas fa-brain"
                },
                "run_resampling": {
                    "type": "boolean",
                    "default": true,
                    "description": "Set it to false if you don't want to resample your data to the smallest current voxel dimension.",
                    "fa_icon": "fas fa-brain"
                },
                "run_tracking": {
                    "type": "boolean",
                    "default": true,
                    "description": "Set it to false if you don't want to run tractography.",
                    "fa_icon": "fas fa-brain"
                }
            }
        },
        "reconst_options": {
            "title": "Reconstruction options",
            "type": "object",
            "fa_icon": "fas fa-brain",
            "description": "Options for the FODF/QBall reconstruction step.",
            "properties": {
                "b0_threshold": {
                    "type": "integer",
                    "default": 100,
                    "hidden": true,
                    "description": "Min b-value to considered as b0.",
                    "fa_icon": "fas fa-brain"
                },
                "shell_tolerance": {
                    "type": "integer",
                    "default": 100,
                    "hidden": true,
                    "description": " The tolerated gap between the b-values to  extract and the actual b-values.",
                    "fa_icon": "fas fa-brain"
                },
                "max_dti_shell_value": {
                    "type": "integer",
                    "default": 3500,
                    "hidden": true,
                    "description": "Maximum DTI shell value used.",
                    "fa_icon": "fas fa-brain"
                },
                "nvox_min": {
                    "type": "integer",
                    "default": 100,
                    "hidden": true,
                    "description": "Minimum number of voxels to include in the computation of the FRF.",
                    "fa_icon": "fas fa-brain"
                },
                "sh_order": {
                    "type": "integer",
                    "default": 6,
                    "hidden": true,
                    "description": "Spherical harmonics order used in the FODF/QBall processing step.",
                    "fa_icon": "fas fa-brain"
                }
            }
        },
        "tracking_options": {
            "title": "Skip steps options",
            "type": "object",
            "fa_icon": "fas fa-forward",
            "description": "Options to skip specific steps of the pipeline.",
            "properties": {
                "local_nbr_seeds": {
                    "type": "integer",
                    "default": 1,
                    "hidden": true,
                    "description": "Number of seeds used in the local tracking step.",
                    "fa_icon": "fas fa-brain"
                },
                "local_step_pct": {
                    "type": "number",
                    "default": 50,
                    "hidden": false,
                    "description": "Percentage step value used in the local tracking step.",
                    "fa_icon": "fas fa-brain"
                },
                "local_theta": {
                    "type": "number",
                    "default": 45,
                    "hidden": true,
                    "description": "Theta value used in the local tracking step.",
                    "fa_icon": "fas fa-brain"
                },
                "local_rk_order": {
                    "type": "integer",
                    "default": 1,
                    "hidden": true,
                    "description": "The order of the Runge-Kutta integration used for the step function.",
                    "fa_icon": "fas fa-brain"
                },
                "local_min_len": {
                    "type": "integer",
                    "default": 3,
                    "hidden": true,
                    "description": "Minimum length used in the local tracking step (mm).",
                    "fa_icon": "fas fa-brain"
                },
                "local_max_len": {
                    "type": "integer",
                    "default": 12,
                    "hidden": true,
                    "description": "Maximum length used in the local tracking step (mm).",
                    "fa_icon": "fas fa-brain"
                }
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/$defs/input_output_options"
        },
        {
            "$ref": "#/$defs/general_options"
        },
        {
            "$ref": "#/$defs/skip_steps_options"
        },
        {
            "$ref": "#/$defs/reconst_options"
        },
        {
            "$ref": "#/$defs/tracking_options"
        }
    ]
}
